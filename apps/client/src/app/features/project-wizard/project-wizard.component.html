<div class="container">
  <header class="header">
    <h1>{{ 'APP.TITLE' | translate }}</h1>
    <p>{{ 'APP.SUBTITLE' | translate }}</p>
  </header>

  <div class="main-grid">
    <!-- Left Column: Create New Project -->
    <div class="card create-card">
      <h2>{{ 'PROJECT.NEW_TITLE' | translate }}</h2>
      <div class="form-group">
        <label for="name">{{ 'PROJECT.NAME_LABEL' | translate }}</label>
        <input type="text" id="name" [(ngModel)]="name" [placeholder]="'PROJECT.NAME_PLACEHOLDER' | translate">
      </div>
      <div class="form-group">
        <label for="description">{{ 'PROJECT.DESCRIPTION_LABEL' | translate }}</label>
        <textarea id="description" [(ngModel)]="description" rows="5"
          [placeholder]="'PROJECT.DESCRIPTION_PLACEHOLDER' | translate"></textarea>
      </div>
      <div class="form-group">
        <label for="provider">{{ 'PROJECT.PROVIDER_LABEL' | translate }}</label>
        <select id="provider" [(ngModel)]="provider">
          <option value="openai">{{ 'PROVIDERS.OPENAI' | translate }}</option>
          <option value="gemini">{{ 'PROVIDERS.GEMINI' | translate }}</option>
          <option value="xai">{{ 'PROVIDERS.XAI' | translate }}</option>
          <option value="huggingface">{{ 'PROVIDERS.HUGGINGFACE' | translate }}</option>
        </select>
      </div>

      <!-- HuggingFace Model Selection -->
      <div class="form-group" *ngIf="provider === 'huggingface'">
        <label for="model">HuggingFace Model</label>
        <select id="model" [(ngModel)]="model">
          <option value="">Default (Qwen 2.5 7B)</option>
          <option *ngFor="let m of huggingfaceModels" [value]="m.value">{{ m.label }}</option>
        </select>
      </div>

      <button class="btn-primary" (click)="createProject()" [disabled]="!name || !description">
        {{ 'PROJECT.GENERATE_BTN' | translate }}
      </button>

      <!-- Project History Toggle -->
      <button class="btn-secondary" (click)="toggleProjectList()" style="margin-top: 1rem;">
        üìã {{ showProjectList ? 'Hide' : 'Show' }} Project History ({{ projects.length }})
      </button>
    </div>

    <!-- Right Column: Live Agent Output -->
    <div class="card agent-output-card">
      <div class="agent-header">
        <h2>ü§ñ Agent Workspace</h2>
        <button *ngIf="activeProject" class="btn-clear" (click)="clearActiveProject()">Clear</button>
      </div>

      <!-- No Active Project -->
      <div *ngIf="!activeProject" class="empty-workspace">
        <div class="empty-icon">üöÄ</div>
        <h3>Ready to Generate</h3>
        <p>Create a new project to see AI agents in action!</p>
      </div>

      <!-- Active Project -->
      <div *ngIf="activeProject" class="active-project">
        <div class="project-info">
          <h3>{{ activeProject.name }}</h3>
          <div class="status-indicator" [class.analyzing]="activeProject.status === 'ANALYZING'"
            [class.awaiting]="activeProject.status === 'AWAITING_REQUIREMENTS_APPROVAL' || activeProject.status === 'AWAITING_CODE_APPROVAL'"
            [class.generating]="activeProject.status === 'GENERATING_CODE'"
            [class.completed]="activeProject.status === 'COMPLETED'"
            [class.rejected]="activeProject.status === 'REJECTED'">
            <span class="status-dot"></span>
            <span class="status-text">{{ activeProject.status }}</span>
          </div>
        </div>

        <!-- Analyzing State -->
        <div *ngIf="activeProject.status === 'ANALYZING'" class="agent-step">
          <div class="step-header">
            <span class="step-icon">üïµÔ∏è</span>
            <h4>Analyst Agent Working...</h4>
          </div>
          <div class="loading-animation">
            <div class="spinner"></div>
            <p>Analyzing your project and generating requirements...</p>
          </div>
        </div>

        <!-- Interviewing State -->
        <div *ngIf="activeProject.status === 'INTERVIEWING'" class="agent-step">
          <div class="step-header">
            <span class="step-icon">ü§î</span>
            <h4>Interviewer Agent Analyzing...</h4>
          </div>
          <div class="loading-animation">
            <div class="spinner"></div>
            <p>Analyzing your description and preparing questions...</p>
          </div>
        </div>

        <!-- Awaiting Answer State -->
        <div *ngIf="activeProject.status === 'AWAITING_ANSWER'" class="agent-step interview-step">
          <div class="step-header">
            <span class="step-icon">üí¨</span>
            <h4>Interview - Please Answer Questions</h4>
          </div>

          <div class="step-content">
            <!-- Conversation History -->
            <div class="conversation">
              <div *ngFor="let msg of activeProject.conversationHistory" class="message"
                [class.agent-message]="msg.role === 'agent'" [class.user-message]="msg.role === 'user'">
                <div class="message-header">
                  <span class="message-icon">{{ msg.role === 'agent' ? 'ü§ñ' : 'üë§' }}</span>
                  <span class="message-role">{{ msg.role === 'agent' ? 'Interviewer' : 'You' }}</span>
                </div>
                <div class="message-content">{{ msg.message }}</div>
              </div>
            </div>

            <!-- Answer Input -->
            <div class="answer-section">
              <label>Your Answer:</label>
              <textarea [(ngModel)]="currentAnswer" rows="4" placeholder="Type your answer here..."
                class="answer-input">
              </textarea>
              <div class="answer-actions">
                <button class="btn-skip-interview" (click)="skipInterview()">
                  ‚è≠Ô∏è Skip Interview
                </button>
                <button class="btn-submit-answer" (click)="submitAnswer()" [disabled]="!currentAnswer">
                  Submit Answer ‚Üí
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- Awaiting Requirements Approval -->
        <div *ngIf="activeProject.status === 'AWAITING_REQUIREMENTS_APPROVAL'" class="agent-step approval-step">
          <div class="step-header">
            <span class="step-icon">üìã</span>
            <h4>Requirements Generated - Your Approval Needed</h4>
          </div>
          <div class="step-content">
            <p class="step-description">The Analyst Agent has generated the following requirements:</p>
            <div class="requirements-grid">
              <div *ngFor="let req of activeProject.pendingRequirements; let i = index" class="requirement-card">
                <span class="req-number">{{ i + 1 }}</span>
                <span class="req-text">{{ req }}</span>
              </div>
            </div>
            <div class="approval-actions">
              <button class="btn-approve" (click)="approveRequirements(true)">
                <span class="btn-icon">‚úì</span>
                Approve & Continue
              </button>
              <button class="btn-reject" (click)="approveRequirements(false)">
                <span class="btn-icon">‚úó</span>
                Reject
              </button>
            </div>
          </div>
        </div>

        <!-- Generating Code State -->
        <div *ngIf="activeProject.status === 'GENERATING_CODE'" class="agent-step">
          <div class="step-header">
            <span class="step-icon">üë®‚Äçüíª</span>
            <h4>Backend Generator Working...</h4>
          </div>
          <div class="loading-animation">
            <div class="spinner"></div>
            <p>Generating NestJS code based on approved requirements...</p>
          </div>
        </div>

        <!-- Awaiting Code Approval -->
        <div *ngIf="activeProject.status === 'AWAITING_CODE_APPROVAL'" class="agent-step approval-step">
          <div class="step-header">
            <span class="step-icon">üíª</span>
            <h4>Code Generated - Your Approval Needed</h4>
          </div>
          <div class="step-content">
            <p class="step-description">The Backend Generator has created the following files:</p>
            <div class="code-preview">
              <div *ngFor="let file of activeProject.pendingCode" class="code-file-preview">
                <div class="file-header">
                  <span class="file-icon">üìÑ</span>
                  <span class="file-name">{{ file.filename }}</span>
                  <span class="file-size">{{ file.code.length }} chars</span>
                </div>
                <pre class="code-block"><code>{{ file.code }}</code></pre>
              </div>
            </div>
            <div class="approval-actions">
              <button class="btn-approve" (click)="approveCode(true)">
                <span class="btn-icon">‚úì</span>
                Approve & Save
              </button>
              <button class="btn-reject" (click)="approveCode(false)">
                <span class="btn-icon">‚úó</span>
                Reject
              </button>
            </div>
          </div>
        </div>

        <!-- Completed State -->
        <div *ngIf="activeProject.status === 'COMPLETED'" class="agent-step completed-step">
          <div class="step-header">
            <span class="step-icon">‚úÖ</span>
            <h4>Project Completed Successfully!</h4>
          </div>
          <div class="step-content">
            <p class="success-message">All requirements and code have been approved and saved.</p>
            <div class="completion-summary">
              <div class="summary-section">
                <h5>‚úì Approved Requirements ({{ activeProject.requirements?.length || 0 }})</h5>
                <div class="requirements-grid">
                  <div *ngFor="let req of activeProject.requirements; let i = index" class="requirement-card completed">
                    <span class="req-number">{{ i + 1 }}</span>
                    <span class="req-text">{{ req }}</span>
                  </div>
                </div>
              </div>
              <div class="summary-section">
                <h5>‚úì Generated Files ({{ activeProject.generatedCode?.length || 0 }})</h5>
                <div class="file-list">
                  <div *ngFor="let file of activeProject.generatedCode" class="file-item">
                    <span class="file-icon">üìÑ</span>
                    <span>{{ file.filename }}</span>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Rejected State -->
        <div *ngIf="activeProject.status === 'REJECTED'" class="agent-step rejected-step">
          <div class="step-header">
            <span class="step-icon">‚ùå</span>
            <h4>Project Rejected</h4>
          </div>
          <p>This project was rejected and will not be completed.</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Project History Sidebar (Collapsible) -->
  <div class="project-history-sidebar" [class.visible]="showProjectList">
    <div class="sidebar-header">
      <h3>Project History</h3>
      <button class="close-sidebar" (click)="toggleProjectList()">√ó</button>
    </div>
    <div class="project-list">
      <div class="project-item" *ngFor="let project of projects" (click)="selectProject(project)">
        <div class="project-header">
          <h4>{{ project.name }}</h4>
          <span class="badge-small" [class.analyzing]="project.status === 'ANALYZING'"
            [class.awaiting]="project.status === 'AWAITING_REQUIREMENTS_APPROVAL' || project.status === 'AWAITING_CODE_APPROVAL'"
            [class.generating]="project.status === 'GENERATING_CODE'" [class.completed]="project.status === 'COMPLETED'"
            [class.rejected]="project.status === 'REJECTED'">
            {{ project.status }}
          </span>
        </div>
        <p class="project-desc">{{ project.description }}</p>
        <span class="project-date">{{ project.createdAt | date:'short' }}</span>
      </div>
      <div class="empty-state" *ngIf="projects.length === 0">
        <p>No projects yet</p>
      </div>
    </div>
  </div>
</div>